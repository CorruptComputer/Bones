@page "/auth/register"
@inject ILogger<Register> Logger
@layout MainLayout

<PageTitle>Register</PageTitle>
<MudText Typo="Typo.h5">Register</MudText>

@if (!RegistrationSuccess)
{
    <MudGrid>
        <MudItem xs="12" sm="7">
            <MudPaper Class="pa-4">
                <MudForm @bind-IsValid="@FormValid" @bind-Errors="@ValidationErrors">
                    <MudTextField T="string" Label="Email" Required="true" RequiredError="Email is required!" @ref="@EmailAddress"
                                  Validation="@(new EmailAddressAttribute() { ErrorMessage = "The email address is invalid"})" />
                
                    <MudTextField T="string" Label="Password" HelperText="Choose a strong password" @ref="@Password"
                                  InputType="InputType.Password"
                                  Validation="@(new Func<IEnumerable<string>>(PasswordStrengthCheck))" Required="true"
                                  RequiredError="Password is required!"/>
                
                    <MudTextField T="string" Label="Password" HelperText="Repeat the password" @ref="@PasswordAgain" 
                                  InputType="InputType.Password" Validation="@(new Func<string?>(PasswordMatch))" />

                    <div class="d-flex align-center justify-space-between">
                        <MudCheckBox T="bool" Required="true" RequiredError="You must agree" Label="I agree!"  />
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" Disabled="@(!FormValid)" Class="ml-auto" OnClick="@DoRegistrationAsync">Register</MudButton>
                    </div>
                </MudForm>
            </MudPaper>
        </MudItem>
        <MudItem xs="12" sm="5">
            <MudItem Class="pa-2" hidden="@(!RegistrationApiError)">
                <MudAlert Severity="Severity.Error">There was an error with the registration, please try again.</MudAlert>
            </MudItem>
        
            @foreach (string error in ValidationErrors)
            {
                <MudItem Class="pa-2">
                    <MudAlert  Severity="Severity.Error">@error</MudAlert>
                </MudItem>
            }
        </MudItem>
    </MudGrid>
}
else
{
    <MudAlert Severity="Severity.Success">Account created successfully, please check your email for a confirmation link.</MudAlert>
}

